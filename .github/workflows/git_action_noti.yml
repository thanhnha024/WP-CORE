name: Wordpress Notifications Git Action

run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€

on: [push]
jobs:

  create-pull-request:
    runs-on: ubuntu-latest
    # Map a step output to a job output
    outputs:
      pull_request_url: ${{ steps.cpr.outputs.pull-request-url }}
    steps:
      - name: Auto create pull request when someone push new changes
        uses: actions/checkout@v4
      - name: Create Pull Request
        id: cpr
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: upadte new change on ${{ github.ref }}
          title: New update adjustment by ${{ github.actor }}
          author: ${{ github.actor }} <${{ github.actor_id }}+${{ github.actor }}@users.noreply.github.com>
          body: |
            Update new changesðŸ’¬:
            - Update new change on  ${{ github.ref }}
          branch: ${{ github.ref }}
          base: master
          reviewers: ThanhNha
          delete-branch: true
      - name: Check outputs
        if: ${{ steps.cpr.outputs.pull-request-number }}
        run: |
          echo "Pull Request Number - ${{ steps.cpr.outputs.pull-request-number }}"
          echo "Pull Request URL - ${{ steps.cpr.outputs.pull-request-url }}"
  notification-to-telegram:
    runs-on: ubuntu-latest
    needs: create-pull-request
    steps:
      - env:
          pull_request_url: ${{needs.create-pull-request.outputs.pull_request_url}}
        run: echo "$pull_request_url"
      - name: send telegram message on push
        uses: appleboy/telegram-action@master
        with:
          to: -1002034905977
          token: 6611988217:AAERCNw3lNbdpABmMztQudQXBuPcp1jsKdk
          message: |
            ðŸ’¥ Please check new commit ðŸ’¥:

            ${{ github.actor }} created commit ðŸ”‘:
            Commit message ðŸ’¬: ${{ github.event.commits[0].message }}

            Project ðŸš€: ${{ github.repository }}
            Project link ðŸ”Ž: https://github.com/${{ github.repository }}
            See changes: https://github.com/${{ github.repository }}/commit/${{github.sha}}

